### 2.7机加上线学习文档

程序运行 程序初始化 检查网络状况 获取特定信息 工位信息 产线信息 



**在界面上展示生产状态信息**

工件到位-条码正确-打刻成功-上线程工-允许放行 变灰

显示登陆人员姓名



尝试ping通服务器(关键)(检查网络状况)

获取监控地址 建立OPC连接 

获取上线数量 从P_ASSEMBLE_PRODUCT_STATE和DOC_ASSEMBLE_PRODUCT_STATE表中

获取待上线计划 从P_PLAN表中

并根据待上线计划从P_PRODUCT_SERIAL表中获取待上线的产品



**在界面上展示订单信息** 

这些信息包括 (总订单)今日订单数 订单产品数 已上线产品数|| (当前订单)订单产品数 已上线产品数



**在界面上展示上线产品信息** 

这些信息包括 批次号 缸体编号 订单号 是否上线 上线时间 



**等待到位信号...**

到位信号触发 **工件到位变绿**

如果是自动模式,就自动读到毛坯码

校验毛坯码和产品批次号正确与否

1. 毛坯码和批次号都不能带中文
2. 在P_PRODUCT_SERIAL表中查找CYLINDER_BLOCK_BARCODE字段是否有重复的毛坯码

校验无误后将毛坯码展示在"毛坯条码"框框中

根据扫到的毛坯码获得缸体编号 具体规则是:若长度大于14且小于35的话,那么前14位就是partcode(物料编号) 若长度大于10的话,如果第二位是B并且3-4位是03或者04,那么partcode就是FA020或FA060

**条码正确变绿**

生成打刻码 打刻码规则:根据产品批次号取得前四位 第五位是年份VIN码 21-M 22-N 23-P 24-R 25-S 26-T 27-V 28-W ...第六位是月份1-C 第七位-第八位是日期01-31  第九、十、十一位：流水号 获取当天同型号产品最大流水号然后+1 

将打刻码重新显示在批次号框框中

往PLC中写打刻成功信息,程序收到打刻信号



往assemble_product_state中插入条码信息和产品批次信息

**上线成功变绿**

**允许放行变绿**

更新上线数量 界面显示已上线 上线时间

**产品放行,清空所有信息**

